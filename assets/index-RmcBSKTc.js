var C=Object.defineProperty;var b=(s,e,t)=>e in s?C(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var v=(s,e,t)=>(b(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function m(s,...e){const t=new CustomEvent("change-page",{detail:{page:s,data:e}});dispatchEvent(t),dispatchEvent(p)}const p=new Event("rerender");class x extends HTMLElement{constructor(e="Название вопроса"){super(),this.questionName=e;const t=document.getElementById("question-editor");this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t.content.cloneNode(!0))}connectedCallback(){const e=this.shadowRoot.getElementById("name"),t=new Event("change");e.onchange=()=>{this.questionName=e.value,this.dispatchEvent(t)}}}class c{constructor(e,t){this.type=e,this.token=t}static fromStorage(){const e=localStorage.getItem("token_type"),t=localStorage.getItem("access_token");if(e&&t)return new c(e,t)}static has(){const e=localStorage.getItem("token_type"),t=localStorage.getItem("access_token");return!!(e&&t)}toAuthorization(){return`${this.type[0].toUpperCase()+this.type.slice(1)} ${this.token}`}}function _(){const s=c.fromStorage();return s?s.toAuthorization():""}class h{constructor(){}render(){const e=document.createElement("t-login"),t=e.shadowRoot.getElementById("login-form");return t.onsubmit=async a=>{a.preventDefault();const n=new FormData(t),o=n.get("email"),r=n.get("password"),i="http://api.lapki.vladexa.ru:8000/api/v1/user/token",d={headers:{"content-type":"application/x-www-form-urlencoded"},body:`grant_type=&username=${o}&password=${r}&scope=&client_id=&client_secret=`,method:"POST"},l=()=>fetch(i,d);let u=await l();if(u.status!==200){const g="http://api.lapki.vladexa.ru:8000/api/v1/user/users",y={headers:{"content-type":"application/json"},body:`{"nickname":"${o}","password": "${r}"}`,method:"POST"};await fetch(g,y),u=await l()}const k=await u.json();localStorage.setItem("name",o.toString());for(const[g,y]of Object.entries(k))localStorage.setItem(g,y);m(q)},history.pushState(void 0,"","login"),e}}class q{constructor(){}render(){c.has()||m(h),history.pushState(void 0,"","survey-creator");const e=document.createElement("t-survey-namer"),t=e.shadowRoot.querySelector("form"),a=t.querySelector("input[type=datetime-local]"),n=new Date;return a.min=n.toISOString().slice(0,16),t.onsubmit=async o=>{o.preventDefault();const r=new FormData(t),i=r.get("name"),d=r.get("date"),l=_();if(!l)return location.replace("/login");if((await fetch("http://api.lapki.vladexa.ru:8000/api/v1/survey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:l},body:`{"name":"${i}","expire_at":"${d}"}`})).status!==200)return alert("Error at creation");m(I,i.toString())},e}}class E{constructor(e="Новый вопрос"){this.title=e}}class I{constructor(e,t=[new E]){this.name=e,this.questions=t}render(){c.has()||m(h),history.pushState({name:this.name},"","survey");const e=document.createElement("t-survey"),t=document.createElement("h2");t.slot="name",t.style.margin="0",t.style.fontSize="2em",t.innerText=history.state.name,e.appendChild(t);const a=e.shadowRoot.getElementById("add-question");a.onclick=()=>{this.questions.push(new E),dispatchEvent(p)};const n=document.createElement("ul");n.slot="questions";for(const o in this.questions){const r=document.createElement("li"),i=document.createElement("section",{is:"t-question-edit"});i.onchange=()=>this.questions[o].title=i.questionName;const d=i.shadowRoot.querySelector("#name");d.value=this.questions[o].title,r.appendChild(i),n.appendChild(r)}return e.appendChild(n),e}}class L{constructor(){v(this,"state");var e;switch(location.pathname){case"/login":this.state=new h;break;case"/survey":this.state=new I(((e=history.state)==null?void 0:e.name)??"None");break;default:this.state=c.has()?new q:new h;break}addEventListener(p.type,()=>{document.startViewTransition?document.startViewTransition(async()=>f.replaceChildren(S.render())):f.replaceChildren(S.render())}),addEventListener("change-page",t=>{const a=t,n=a.detail.page,o=a.detail.data;this.state=new n(...o)})}render(){return this.state.render()}}const S=new L;let f;function w(s,e){customElements.define(e,class extends HTMLElement{constructor(){super();const t=document.getElementById(s).content;this.attachShadow({mode:"open"}).appendChild(t.cloneNode(!0))}})}w("login","t-login");w("survey-namer","t-survey-namer");w("survey","t-survey");customElements.define("t-header",class extends HTMLElement{constructor(){super();const s=document.getElementById("logged-in-header").content;this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(s.cloneNode(!0))}connectedCallback(){this.shadowRoot.getElementById("name").innerText=localStorage.getItem("name")}},{extends:"header"});customElements.define("t-question-edit",x,{extends:"section"});addEventListener("load",()=>{f=document.getElementById("root"),dispatchEvent(p)},{once:!0});
